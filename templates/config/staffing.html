{% load static %}
{% load dict_extras %}

<!DOCTYPE html>
<html>
<head>
    <title>Staffing Configuration</title>
    <link rel="stylesheet" href="{% static 'css/staffing.css' %}">
</head>
<body>

<h2>Bar Staffing Configuration</h2>
<p>Click a cell to change workers. Use +1 to increase workers for the whole hour.</p>

<div class="page-layout">

    <!-- LEFT: GRID -->
    <div class="grid-container">
        <table id="grid">

            <tr>
                <th>Hour</th>
                {% for day in day_names %}
                    <th>{{ day }}</th>
                {% endfor %}
                <th>+1</th>
            </tr>

            {% for hour in hours %}
            <tr>
                <th>{{ hour }}</th>

                {% for day in days %}
                    {% with workers=saved|get_item:day|get_item:hour %}
                        {% if day in closed_days or hour < opening_hour or hour >= closing_hour %}
                            <td class="closed-hour">â€“</td>
                        {% else %}
                            <td class="open-hour workers-{{ workers|default:1 }}"
                                data-day="{{ day }}"
                                data-hour="{{ hour }}"
                                data-workers="{{ workers|default:1 }}">
                                {{ workers|default:1 }}
                            </td>
                        {% endif %}
                    {% endwith %}
                {% endfor %}

                <td>
                    <button class="hour-plus-btn" data-hour="{{ hour }}">+1</button>
                </td>
            </tr>
            {% endfor %}

        </table>
    </div>

    <!-- RIGHT: CONTROLS -->
    <div class="controls-container">

        <h3>Bar Configuration</h3>

        <h4>Closed Days</h4>
        {% for i in days %}
            <label>
                <input type="checkbox"
                       class="closed-day-checkbox"
                       value="{{ i }}"
                       {% if i in closed_days %}checked{% endif %}>
                {{ day_names|slice:i|last }}
            </label><br>
        {% endfor %}

        <div class="control-group">
            <label>Opening Hour</label>
            <input type="range" id="openingHour" min="0" max="23" value="{{ opening_hour }}">
            <span id="openingHourValue"></span>
        </div>

        <div class="control-group">
            <label>Closing Hour</label>
            <input type="range" id="closingHour" min="1" max="24" value="{{ closing_hour }}">
            <span id="closingHourValue"></span>
        </div>

        <div class="control-group">
            <label>Max Workers per Hour</label>
            <input type="range" id="maxWorkers" min="1" max="10" value="{{ max_workers }}">
            <span id="maxWorkersValue"></span>
        </div>

        <button class="save-btn" onclick="saveConfig()">Save Configuration</button>

        <hr>

        <h3>Workers</h3>
        {% if workers %}
            <ul class="worker-list">
                {% for worker in workers %}
                    <li>
                        <strong>{{ worker.name }}</strong><br>
                        Priority: {{ worker.priority }}<br>
                        Min hours / week: {{ worker.min_hours_per_week }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No workers added yet.</p>
        {% endif %}
    </div>

</div>

<script src="{% static 'js/staffing.js' %}"></script>
</body>
</html>
